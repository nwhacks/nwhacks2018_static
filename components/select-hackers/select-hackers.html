<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">

<link rel="import" href="../firebase-config/firebase-config.html">
<link rel="import" href="../lunr-js.html">
<link rel="import" href="../moment-js.html">
<link rel="import" href="../light-page.html">
<link rel="import" href="../review-submission.html">
<link rel="import" href="../nw-score.html">

<dom-module id="select-hackers">
  <template>
    <style include="light-page">
      :host {
        display: flex;
        flex-direction: column;

        height: calc(100vh - 65px);

        padding-bottom: 0;
        height: calc(100vh - 65px);
        padding: 0;

        --paper-input-container: {
          padding-bottom: 16px;
        };
      }

      #filters {
        padding: 0 15px 15px;
        border-bottom: 1px solid #eee;
      }

      iron-list {
        margin: 0 0;
        overflow-x: hidden;
      }

      paper-input, paper-dropdown-menu {
        display: inline-block;
      }
      table {
        text-align: left;
        width: 100%;
        table-layout: fixed;
      }
      a {
        color: green;
      }
      .tag {
        color: green;
        font-weight: bold;
        display: inline-block;
        padding: 5px;
        margin: 5px;
        border: 2px solid green;
      }
      .tag.bad {
        color: red;
        border-color: red;
      }
      .tag.warn {
        color: orange;
        border-color: orange;
      }
      .right {
        float: right;
      }
      .card-actions {
        display: flex;
        justify-content: space-between;
      }
      .card-actions paper-checkbox {
        margin-left: 8px;
      }
      a {
        cursor: pointer;
      }
      [label="Status"] {
        width: 100px;
      }
      [label="Response"] {
        width: 170px;
      }

      #container {
        display: flex;
        flex-grow: 10000;
      }

      #list {
        width: 320px;
        flex-shrink: 0;
      }
      #list[big] {
        flex-grow: 10000;
      }

      #review {
        flex-grow: 1000;
      }

      paper-item {
        cursor: pointer;
      }
    </style>
    <div id="filters">
      <paper-dropdown-menu label="Form" selected-item-label="{{form}}">
        <paper-listbox slot="dropdown-content">
          <paper-item>registration</paper-item>
          <paper-item>mentorexpo</paper-item>
          <paper-item>volunteer</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
      &nbsp;

      <paper-dropdown-menu label="Status" selected-item-label="{{filters.status}}">
        <paper-listbox slot="dropdown-content" selected="[[selected(hacker.status)]]">
          <paper-item>All</paper-item>
          <template is="dom-repeat" items="[[categories]]">
            <paper-item>[[item]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
      &nbsp;

      <paper-dropdown-menu label="Response" selected-item-label="{{filters.response}}">
        <paper-listbox slot="dropdown-content" selected="[[responded(hacker.response)]]">
          <paper-item>All</paper-item>
          <template is="dom-repeat" items="[[responseCategories]]">
            <paper-item>[[item]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
      &nbsp;

      <paper-input
        label="Search"
        value="{{filters.search}}"
        minlength="3"
        auto-validate>
      </paper-input>

      <paper-checkbox checked="{{filters.first}}">First Time</paper-checkbox> &nbsp;
      <paper-checkbox checked="{{filters.reimbursement}}">Needs Reimbursement</paper-checkbox> &nbsp;
      <paper-checkbox checked="{{filters.checked_in}}">Checked In</paper-checkbox> &nbsp;

      Showing
      <span>{{filteredCount}}</span>
      of
      <span>{{totalCount}}</span>

      <a on-tap="export">Export to CSV</a>
    </div>

    <div id="container">
      <iron-list
        id="list"
        items="{{filtered}}"
        big$="[[!sid]]"
        as="hacker">
        <template>
          <div>
            <paper-item on-tap="select">
              <paper-item-body two-line>
                <div>
                  [[title(hacker)]]
                  <span class="right">[[index(hacker)]]</span>
                </div>
                <div secondary>
                  [[hacker.email]]
                  <template is="dom-if" if="[[hacker.criteria]]">
                    <nw-score
                      score="[[hacker.criteria.score]]"
                      total="[[hacker.criteria.total]]"
                      class="right">
                    </nw-score>
                  </template>
                </div>
              </paper-item-body>
            </paper-item>
          </div>
        </template>
      </iron-list>

      <review-submission
        hidden$="[[!sid]]"
        id="review"
        form="[[form]]"
        sid="[[sid]]"
        email="[[user.email]]"
        name="[[user.displayName]]"
        questions="[[questions]]">
      </review-submission>
    </div>

    <paper-dialog id="error" modal>
      <h2>Error</h2>
      <p>[[error]]</p>
      <p>Please try again later or use a different browser.</p>
      <div class="buttons">
        <paper-button dialog-confirm autofocus>close</paper-button>
      </div>
    </paper-dialog>

    <firebase-config
      is-admin="{{isAdmin}}"
      handle-error="[[handleError]]"
      user="{{user}}"
      auth>
    </firebase-config>

    <firebase-query
      id="regs"
      disabled="[[!isAdmin]]"
      path="/form/[[form]]"
      data="{{registrations}}">
    </firebase-query>

  </template>
  <script src="/bower_components/lunr.js/lunr.min.js"></script>
  <script src="/bower_components/comma-separated-values/csv.min.js"></script>
  <script src="./select-hackers.js"></script>
</dom-module>
