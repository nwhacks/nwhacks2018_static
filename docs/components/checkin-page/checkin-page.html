<html><head></head><body><dom-module id="checkin-page"><template><style>:host{margin:0 auto;max-width:600px;--primary-text-color:#FFFFFF;--secondary-text-color:#CCCCCC;--primary-color:#90cfaa;display:block;}paper-card{width:100%;color:black;}paper-checkbox{width:100%;margin-top:16px;box-sizing:border-box;text-decoration:none;letter-spacing:2px;border-radius:3px;border:none;font-weight:bold;letter-spacing:3px;padding:11px 15px;text-transform:uppercase;cursor:pointer;border-bottom:4px solid #D74343;background-color:#FF6B6B;--paper-checkbox-label:{width:100%;text-align:center;position:absolute;left:0;padding-left:0;};transition:background-color 140ms, border-color 140ms;}paper-checkbox[checked]{border-color:#4BAE74;background-color:#90cfaa;}[bad]{color:red;}[good]{color:green;}[warn]{color:orange;}.completion{padding:10px;cursor:pointer;}.completion:hover{background-color:rgba(0,0,0,0.2);}.completion[selected]{background-color:rgba(0,0,0,0.5);}[hidden]{display:none;}code{font-family:monospace;background-color:rgba(0,0,0,0.5);padding:6px;}h3{margin-top:80px;}paper-card p{font-size:24pt;text-align:center;text-transform:capitalize;padding:10px;font-weight:lighter;border-radius:3px;}paper-card p[warn]{background-color:#f28500;color:white;}paper-card p[danger]{background-color:#D74343;color:white;}p:empty{display:none;}p:first-child{margin-top:0;}</style><h1>Check-In</h1><center><p><small><b>Shortcuts:</b> Search <code>/</code>, Check-In <code>space</code></small></p></center><paper-input label="Search" value="{{query}}" id="search"><iron-icon icon="icons:search" prefix=""></iron-icon></paper-input><template is="dom-repeat" items="[[autocomplete]]"><div class="completion" selected$="[[eq(index, autocompleteIndex)]]" on-tap="handleTap">[[name(registrations, item)]] &lt;[[email(registrations, item)]]&gt;</div></template><paper-card heading="[[heading(display)]]" hidden$="[[!display]]"><div class="card-content"><p warn$="[[warnStatus(display)]]" danger$="[[dangerStatus(display)]]">[[displayStatus(display)]]</p><p warn$="[[warnAge(display.rsvp.age)]]">[[display.rsvp.age]]</p><paper-checkbox id="checkbox" checked="{{display.checked_in}}">Checked In</paper-checkbox></div></paper-card><firebase-config is-admin="{{isAdmin}}" auth="" name="checkin"></firebase-config><template is="dom-if" if="[[isAdmin]]"><firebase-document id="regs" app-name="checkin" path="/registrations" data="{{registrations}}"></firebase-document></template></template><script>Polymer({is:'checkin-page',properties:{display:{value:!1}},observers:['handleRegistrations(registrations)','handleSearch(query, lunr)','updateStatus(display.checked_in)'],ready:function(){var a=this;this.$.search.addEventListener('keydown',function(b){if(b.stopPropagation(),'ArrowDown'===b.code)a.autocompleteIndex=Math.min(a.autocompleteIndex+1,a.autocomplete.length-1);else if('ArrowUp'===b.code)a.autocompleteIndex=Math.max(a.autocompleteIndex-1,0);else if('Enter'===b.code)a.select();else return;b.preventDefault()}),this.keyHandler=this.keyHandler.bind(this)},attached:function(){document.addEventListener('keydown',this.keyHandler)},detached:function(){document.removeEventListener('keydown',this.keyHandler)},keyHandler:function(a){if('Slash'===a.code)this.$.search.inputElement.focus();else if('Space'===a.code&&this.display)this.set('display.checked_in',!this.display.checked_in);else return;a.preventDefault()},handleTap:function(a){this.autocompleteIndex=a.model.index,this.select()},select:function(){var a=this.autocomplete[this.autocompleteIndex];if(a){this.displayID=a;var b=this.registrations[a];void 0===b.checked_in&&(b.checked_in=!1),this.query='',this.display=b,this.autocomplete=[],this.$.search.inputElement.blur()}},heading:function(a){return a.name+' <'+a.email+'>'},eq:function(c,a){return c===a},handleRegistrations:function(a){this.updateDuplicateIndex(a),this.updateLunrIndex(a)},updateDuplicateIndex:function(a){var b=this,c=Object.keys(a).sort(),d={};c.forEach(function(c){var e=a[c],f=b.cleanEmail(e.email);e.cleanEmail=f;var g=d[f]||{count:0},h=g.count;d[f]={last:e.id,count:h+1}});var e={};c.forEach(function(b,c){var f=a[b],g=d[f.cleanEmail],h=g.last,i=g.count;1<i&&h!==f.id&&(e[c]=!0)}),this.duplicateIndices=e},cleanEmail:function(a){return a.toLowerCase().trim()},handleSearch:function(a){var b=this.lunr.search(a).slice(0,5).map(function(b){return b.ref});JSON.stringify(b)!==JSON.stringify(this.autocomplete)&&(this.autocompleteIndex=0,this.autocomplete=b,this.display=!1)},updateLunrIndex:function(a){var b=this,c=Object.keys(a).sort(),d=c.length;if(this.lastLunrIndexCount!==d){this.lastLunrIndexCount=d;var e=lunr(function(){this.ref('id'),this.field('email'),this.field('emailSplit'),this.field('name')});c.forEach(function(c,d){if(!b.duplicateIndices[d]){var f=a[c];e.add({id:c,email:f.email,emailSplit:f.email.replace(/\W+/g,' '),name:f.name})}}),this.lunr=e}},name:function(a,b){return a[b].name},email:function(a,b){return a[b].email},warnStatus:function(a){var b=this.displayStatus(a);return'Accepted, No Response'===b||'waitlisted'===b},dangerStatus:function(a){var b=this.displayStatus(a);return'rejected'===b},displayStatus:function(a){return'accepted'===a.status?a.rsvp?'accepted':'Accepted, No Response':a.status},warnAge:function(a){return a&&-1!==a.indexOf('under')},updateStatus:function(){var a=this.querySelector('#regs');a&&this.displayID&&this.display&&a.setStoredValue('/registrations/'+this.displayID+'/checked_in',this.display.checked_in)}});</script></dom-module></body></html>