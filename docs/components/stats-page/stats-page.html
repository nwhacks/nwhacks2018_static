<html><head></head><body><div hidden="" by-polymer-bundler=""><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js" integrity="sha256-aUydBd3D3p3+5tVJXERlqMtoCej+p4tdD+dkJgeRWNU=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js" integrity="sha256-8E6QUcFg1KTnpEU8TFGhpTGHw5fJqB9vCms3OhAYLqw=" crossorigin="anonymous"></script><dom-module id="category-chart" assetpath="../"><template><style>canvas{background-color:white;}.chart-container{overflow-x:auto;}</style><h2>[[label]]</h2><br><div class="chart-container"><center><canvas id="chart" height="480"></canvas></center></div></template><script>'use strict';Polymer({is:'category-chart',properties:{label:{type:String},data:{type:Array,value:function(){return[]},observer:'updateChart'}},updateChart:function(){var c={};this.data.forEach(function(a){c[a]=(c[a]||0)+1});var a=Object.keys(c);a.sort(function(d,a){return c[a]-c[d]});var b=a.map(function(a){return c[a]}),d={labels:a,datasets:[{label:this.label,data:b,backgroundColor:'rgba(220,0,0,0.5)',borderColor:'rgba(220,0,0,0.8)'}]};this.chart&&this.chart.destroy(),this.$.chart.width=60*a.length;var e=this.$.chart.getContext('2d');this.chart=new Chart(e,{type:'bar',data:d,options:{responsive:!1}},{})},randomColor:function(){for(var a=['0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'],b='#',c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b}});</script></dom-module></div><dom-module id="stats-page"><template><style include="light-page">table{width:calc(100% - 32px);}table td:first-child{font-weight:bold;}.chart-container{margin:15px 0;width:100%;overflow-x:auto;}canvas{background-color:white;}h1{padding-top:1em;}</style><h1 title="">Live Registration Stats</h1><center><table class="striped"><thead><tr><th></th><th>Count</th></tr></thead><tbody><tr><td>Total Registrations</td><td>[[registrationCount]]</td></tr><tr><td>De-duplicated (by email)</td><td>[[deDupStudents]]</td></tr><tr><td>Accepted</td><td>[[acceptedStudents]]</td></tr><tr><td>RSVP yes/no</td><td>[[rsvpStudents]]</td></tr><tr><td>Accepted and Going</td><td>[[going]]</td></tr><tr><td>Checked-In</td><td>[[checked_in]]</td></tr><tr><td>NFC Written</td><td>[[nfc_written]]</td></tr><tr><td>NFC Or Checked In</td><td>[[nfc_or_checked_in]]</td></tr></tbody></table></center><p></p><h2>Response</h2><div class="chart-container"><center><canvas id="response" width="640" height="480"></canvas></center></div><h2>University</h2><div class="chart-container"><canvas id="university" width="3000" height="700"></canvas></div><h2>City</h2><div class="chart-container"><canvas id="city" width="3000" height="700"></canvas></div><h2>T-Shirt</h2><p>This is tshirt information for everyone that was accepted and RSVPed.</p><div class="chart-container"><canvas id="tshirt" width="640" height="480"></canvas></div><category-chart label="Dietary Restrictions" data="[[dietaryRestrictions]]"></category-chart><category-chart label="Gender" data="[[rsvpGender]]"></category-chart><category-chart label="Faculty" data="[[rsvpFaculty]]"></category-chart><category-chart label="Year" data="[[rsvpYear]]"></category-chart><category-chart label="Passport" data="[[rsvpPassport]]"></category-chart><category-chart label="Majority (Age)" data="[[rsvpMajority]]"></category-chart><firebase-query id="regs" disabled="[[!isAdmin]]" path="/form/registration" data="{{registrations}}"></firebase-query></template><script>var patterns={"University of British Columbia":['UBC','University of British Columbia','University of the British Columbia','University of British Colombia','university british columbia'],"Simon Fraser University":['SFU','Simon Fraser','Somion Fraser'],"University of Waterloo":['Waterloo'],BCIT:['BCIT','British Columbia Institute of Technology'],"University of Illinois Urbana-Champaign":['Urbana-Champaign','Urbana Champaign'],"McGill University":['McGill'],"University of Washington":['University of Washington','UW','University of Washingon']},patternsCities={Vancouver:['UBC','University of British Columbia','Vanouver','Vancouver','Gage','Marine Drive','Locally','Vancover','Campus','N/a','University of the British Columbia','University of British Colombia','university british columbia'],Seattle:['University of Washington']};Polymer({is:'stats-page',observers:['renderData(registrations)'],renderData:function(a){_.each(this.charts,function(a){a.destroy()}),this.charts=[];var b=this.charts;this.registrationCount=a.length;var c={},d={},e={},f=0,g=0,h=0,i=0,j=0,k=0,l=0,m={labels:['S','M','L','XL'],datasets:[{label:'Offered Sizes',backgroundColor:'rgba(220,0,0,0.5)',borderColor:'rgba(220,0,0,0.8)',data:[0,0,0,0]}]},n={labels:['No Response','Going','Not Going'],datasets:[{data:[0,0,0],backgroundColor:['#666','#4BAE74','#FF6B6B'],hoverBackgroundColor:['#888','#377F54','#D74343']}]},o=this;_.each(a,function(a){_.each(patterns,function(b,c){_.each(b,function(b){0<=(a.school||'').toLowerCase().trim().indexOf(b.toLowerCase())&&(a.school=c)})}),_.each(patternsCities,function(b,c){_.each(b,function(b){0<=(a.city||'').toLowerCase().trim().indexOf(b.toLowerCase())&&(a.city=c)})}),a.email&&(a.email=a.email.toLowerCase().trim());var b,p=a.email,q=d[p]&&'accepted'!=a.status||d[p]&&'accepted'==d[p].status,r=!1,s=!0,t=!1;try{for(var u,v,w=Object.keys(a.tags||{})[Symbol.iterator]();!(s=(u=w.next()).done);s=!0)v=u.value,-1!==v.indexOf('accepted')&&(r=!0)}catch(a){t=!0,b=a}finally{try{!s&&w.return&&w.return()}finally{if(t)throw b}}var x=r&&a.rsvp&&a.rsvp.going;if(r){var y=0;x?y=1:a.rsvp&&!a.rsvp.going&&(y=2),n.datasets[0].data[y]++,a.rsvp&&i++}if(a.nfc_written&&k++,a.checked_in&&j++,(a.checked_in||a.nfc_written)&&l++,!q){if(f++,d[p]=a,x){var z=m.labels.indexOf(a.tshirt);m.datasets[0].data[z]+=1}c[a.school]||(c[a.school]={name:a.school,accepted:0,acceptedResp:0,total:0}),c[a.school].total+=1;var A=o.toTitleCase((a.city||'').split(',')[0].trim());e[A]||(e[A]={name:A,accepted:0,acceptedResp:0,total:0}),e[A].total+=1,r&&(c[a.school].accepted+=1,e[A].accepted+=1,g++,h++),x&&(c[a.school].acceptedResp+=1,e[A].acceptedResp+=1)}}),this.deDupStudents=f,this.acceptedStudents=g,this.rsvpStudents=i,this.offeredStudents=h;var p={labels:[],datasets:[{label:'Total Students',backgroundColor:'rgba(220,0,0,0.5)',borderColor:'rgba(220,0,0,0.8)',data:[]},{label:'Offered Students',backgroundColor:'rgba(0,0,220,0.5)',borderColor:'rgba(0,0,220,0.8)',data:[]},{label:'Going Students',backgroundColor:'rgba(0,220,220,0.5)',borderColor:'rgba(0,220,220,0.8)',data:[]}]},q=_(c).toArray().sortBy(['accepted','total']).reverse().value();_.each(q,function(a){p.labels.push(a.name),p.datasets[0].data.push(a.total),p.datasets[1].data.push(a.accepted),p.datasets[2].data.push(a.acceptedResp)});var r=this.$.university.getContext('2d');b.push(new Chart(r,{type:'bar',data:p,options:{responsive:!1}},{}));var s={labels:[],datasets:[{label:'Total Students',backgroundColor:'rgba(0,220,0,0.5)',borderColor:'rgba(0,220,0,0.8)',data:[]},{label:'Offered Students',backgroundColor:'rgba(0,0,220,0.5)',borderColor:'rgba(0,0,220,0.8)',data:[]},{label:'Going Students',backgroundColor:'rgba(0,220,220,0.5)',borderColor:'rgba(0,220,220,0.8)',data:[]}]},t=_(e).toArray().sortBy(['accepted','total']).reverse().value();_.each(t,function(a){s.labels.push(a.name),s.datasets[0].data.push(a.total),s.datasets[1].data.push(a.accepted),s.datasets[2].data.push(a.acceptedResp)});var r=this.$.city.getContext('2d');b.push(new Chart(r,{type:'bar',data:s,options:{responsive:!1}},{}));var r=this.$.tshirt.getContext('2d');b.push(new Chart(r,{type:'bar',data:m,options:{responsive:!1}},{}));var r=this.$.response.getContext('2d');b.push(new Chart(r,{type:'doughnut',data:n,options:{responsive:!1}},{})),this.going=n.datasets[0].data[1];var u=a.filter(function(b){return b.rsvp&&b.rsvp.going});this.dietaryRestrictions=u.map(function(b){return b.dietary_other?b.dietary+' - '+b.dietary_other:b.dietary}),this.rsvpGender=u.map(function(b){return b.gender}),this.rsvpFaculty=u.map(function(b){return b.major}),this.rsvpYear=u.map(function(b){return b.graduation}),this.rsvpPassport=u.map(function(b){return b.passport}),this.rsvpMajority=u.map(function(b){return moment(b.birthday).fromNow(!0)}),this.checked_in=j,this.nfc_written=k,this.nfc_or_checked_in=l},toTitleCase:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}});</script></dom-module></body></html>