<html><head></head><body><div hidden="" by-polymer-bundler=""><script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js" integrity="sha256-aUydBd3D3p3+5tVJXERlqMtoCej+p4tdD+dkJgeRWNU=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js" integrity="sha256-8E6QUcFg1KTnpEU8TFGhpTGHw5fJqB9vCms3OhAYLqw=" crossorigin="anonymous"></script><dom-module id="category-chart" assetpath="../"><template><style>canvas{background-color:white;}.chart-container{overflow-x:auto;}</style><h2>[[label]]</h2><br><div class="chart-container"><center><canvas id="chart" height="480"></canvas></center></div></template><script>"use strict";Polymer({is:"category-chart",properties:{label:{type:String},data:{type:Array,value:function value(){return[]},observer:"updateChart"}},updateChart:function updateChart(){var categories={};this.data.forEach(function(item){categories[item]=(categories[item]||0)+1});var labels=Object.keys(categories);labels.sort(function(a,b){return categories[b]-categories[a]});var data=labels.map(function(label){return categories[label]}),displayData={labels:labels,datasets:[{label:this.label,data:data,backgroundColor:"rgba(220,0,0,0.5)",borderColor:"rgba(220,0,0,0.8)"}]};if(this.chart){this.chart.destroy()}this.$.chart.width=60*labels.length;var ctx=this.$.chart.getContext("2d");this.chart=new Chart(ctx,{type:"bar",data:displayData,options:{responsive:!1}},{})},randomColor:function randomColor(){for(var letters="0123456789ABCDEF".split(""),color="#",i=0;6>i;i++){color+=letters[Math.floor(16*Math.random())]}return color}});</script></dom-module></div><dom-module id="stats-page"><template><style include="light-page">table{width:calc(100% - 32px);}table td:first-child{font-weight:bold;}.chart-container{margin:15px 0;width:100%;overflow-x:auto;}canvas{background-color:white;}h1{padding-top:1em;}</style><h1 title="">Live Registration Stats</h1><center><table class="striped"><thead><tr><th></th><th>Count</th></tr></thead><tbody><tr><td>Total Registrations</td><td>[[registrationCount]]</td></tr><tr><td>De-duplicated (by email)</td><td>[[deDupStudents]]</td></tr><tr><td>Accepted</td><td>[[acceptedStudents]]</td></tr><tr><td>RSVP yes/no</td><td>[[rsvpStudents]]</td></tr><tr><td>Accepted and Going</td><td>[[going]]</td></tr><tr><td>Checked-In</td><td>[[checked_in]]</td></tr><tr><td>NFC Written</td><td>[[nfc_written]]</td></tr><tr><td>NFC Or Checked In</td><td>[[nfc_or_checked_in]]</td></tr></tbody></table></center><p></p><h2>Response</h2><div class="chart-container"><center><canvas id="response" width="640" height="480"></canvas></center></div><h2>University</h2><div class="chart-container"><canvas id="university" width="3000" height="700"></canvas></div><h2>City</h2><div class="chart-container"><canvas id="city" width="3000" height="700"></canvas></div><h2>T-Shirt</h2><p>This is tshirt information for everyone that was accepted and RSVPed.</p><div class="chart-container"><canvas id="tshirt" width="640" height="480"></canvas></div><category-chart label="Dietary Restrictions" data="[[dietaryRestrictions]]"></category-chart><category-chart label="Gender" data="[[rsvpGender]]"></category-chart><category-chart label="Faculty" data="[[rsvpFaculty]]"></category-chart><category-chart label="Year" data="[[rsvpYear]]"></category-chart><category-chart label="Passport" data="[[rsvpPassport]]"></category-chart><category-chart label="Majority (Age)" data="[[rsvpMajority]]"></category-chart><firebase-query id="regs" disabled="[[!isAdmin]]" path="/form/registration" data="{{registrations}}"></firebase-query></template><script>var patterns={"University of British Columbia":["UBC","University of British Columbia","University of the British Columbia","University of British Colombia","university british columbia"],"Simon Fraser University":["SFU","Simon Fraser","Somion Fraser"],"University of Waterloo":["Waterloo"],BCIT:["BCIT","British Columbia Institute of Technology"],"University of Illinois Urbana-Champaign":["Urbana-Champaign","Urbana Champaign"],"McGill University":["McGill"],"University of Washington":["University of Washington","UW","University of Washingon"]},patternsCities={Vancouver:["UBC","University of British Columbia","Vanouver","Vancouver","Gage","Marine Drive","Locally","Vancover","Campus","N/a","University of the British Columbia","University of British Colombia","university british columbia"],Seattle:["University of Washington"]};Polymer({is:"stats-page",observers:["renderData(registrations)"],renderData:function renderData(registrations){_.each(this.charts,function(chart){chart.destroy()});this.charts=[];var charts=this.charts;this.registrationCount=registrations.length;var univs={},students={},cities={},deDupStudents=0,acceptedStudents=0,offeredStudents=0,rsvpStudents=0,checked_in=0,nfc_written=0,nfc_or_checked_in=0,tshirtData={labels:["S","M","L","XL"],datasets:[{label:"Offered Sizes",backgroundColor:"rgba(220,0,0,0.5)",borderColor:"rgba(220,0,0,0.8)",data:[0,0,0,0]}]},responseData={labels:["No Response","Going","Not Going"],datasets:[{data:[0,0,0],backgroundColor:["#666","#4BAE74","#FF6B6B"],hoverBackgroundColor:["#888","#377F54","#D74343"]}]},self=this;_.each(registrations,function(datum){_.each(patterns,function(pattern,remap){_.each(pattern,function(p){if(0<=(datum.school||"").toLowerCase().trim().indexOf(p.toLowerCase())){datum.school=remap}})});_.each(patternsCities,function(pattern,remap){_.each(pattern,function(p){if(0<=(datum.city||"").toLowerCase().trim().indexOf(p.toLowerCase())){datum.city=remap}})});if(datum.email){datum.email=datum.email.toLowerCase().trim()}for(var email=datum.email,isDuplicate=students[email]&&"accepted"!=datum.status||students[email]&&"accepted"==students[email].status,accepted=!1,_arr=Object.keys(datum.tags||{}),_i=0,key;_i<_arr.length;_i++){key=_arr[_i];if(-1!==key.indexOf("accepted")){accepted=!0}}var going=accepted&&datum.rsvp&&datum.rsvp.going;if(accepted){var _index=0;if(going){_index=1}else if(datum.rsvp&&!datum.rsvp.going){_index=2}responseData.datasets[0].data[_index]++;if(datum.rsvp){rsvpStudents++}}if(datum.nfc_written){nfc_written++}if(datum.checked_in){checked_in++}if(datum.checked_in||datum.nfc_written){nfc_or_checked_in++}if(isDuplicate){return}deDupStudents++;students[email]=datum;if(going){var index=tshirtData.labels.indexOf(datum.tshirt);tshirtData.datasets[0].data[index]+=1}if(!univs[datum.school]){univs[datum.school]={name:datum.school,accepted:0,acceptedResp:0,total:0}}univs[datum.school].total+=1;var location=self.toTitleCase((datum.city||"").split(",")[0].trim());if(!cities[location]){cities[location]={name:location,accepted:0,acceptedResp:0,total:0}}cities[location].total+=1;if(accepted){univs[datum.school].accepted+=1;cities[location].accepted+=1;acceptedStudents++;offeredStudents++}if(going){univs[datum.school].acceptedResp+=1;cities[location].acceptedResp+=1}});this.deDupStudents=deDupStudents;this.acceptedStudents=acceptedStudents;this.rsvpStudents=rsvpStudents;this.offeredStudents=offeredStudents;var data={labels:[],datasets:[{label:"Total Students",backgroundColor:"rgba(220,0,0,0.5)",borderColor:"rgba(220,0,0,0.8)",data:[]},{label:"Offered Students",backgroundColor:"rgba(0,0,220,0.5)",borderColor:"rgba(0,0,220,0.8)",data:[]},{label:"Going Students",backgroundColor:"rgba(0,220,220,0.5)",borderColor:"rgba(0,220,220,0.8)",data:[]}]},sortedUnivs=_(univs).toArray().sortBy(["accepted","total"]).reverse().value();_.each(sortedUnivs,function(v){data.labels.push(v.name);data.datasets[0].data.push(v.total);data.datasets[1].data.push(v.accepted);data.datasets[2].data.push(v.acceptedResp)});var ctx=this.$.university.getContext("2d");charts.push(new Chart(ctx,{type:"bar",data:data,options:{responsive:!1}},{}));var dataCities={labels:[],datasets:[{label:"Total Students",backgroundColor:"rgba(0,220,0,0.5)",borderColor:"rgba(0,220,0,0.8)",data:[]},{label:"Offered Students",backgroundColor:"rgba(0,0,220,0.5)",borderColor:"rgba(0,0,220,0.8)",data:[]},{label:"Going Students",backgroundColor:"rgba(0,220,220,0.5)",borderColor:"rgba(0,220,220,0.8)",data:[]}]},sortedCities=_(cities).toArray().sortBy(["accepted","total"]).reverse().value();_.each(sortedCities,function(v){dataCities.labels.push(v.name);dataCities.datasets[0].data.push(v.total);dataCities.datasets[1].data.push(v.accepted);dataCities.datasets[2].data.push(v.acceptedResp)});var ctx=this.$.city.getContext("2d");charts.push(new Chart(ctx,{type:"bar",data:dataCities,options:{responsive:!1}},{}));var ctx=this.$.tshirt.getContext("2d");charts.push(new Chart(ctx,{type:"bar",data:tshirtData,options:{responsive:!1}},{}));var ctx=this.$.response.getContext("2d");charts.push(new Chart(ctx,{type:"doughnut",data:responseData,options:{responsive:!1}},{}));this.going=responseData.datasets[0].data[1];var rsvped=registrations.filter(function(a){return a.rsvp&&a.rsvp.going});this.dietaryRestrictions=rsvped.map(function(a){if(a.dietary_other){return"".concat(a.dietary," - ").concat(a.dietary_other)}return a.dietary});this.rsvpGender=rsvped.map(function(a){return a.gender});this.rsvpFaculty=rsvped.map(function(a){return a.major});this.rsvpYear=rsvped.map(function(a){return a.graduation});this.rsvpPassport=rsvped.map(function(a){return a.passport});this.rsvpMajority=rsvped.map(function(a){return moment(a.birthday).fromNow(!0)});this.checked_in=checked_in;this.nfc_written=nfc_written;this.nfc_or_checked_in=nfc_or_checked_in},toTitleCase:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}});</script></dom-module></body></html>