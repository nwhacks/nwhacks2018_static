<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="html-sandbox" assetpath="../"><template><style>:host{display:flex;margin:16px 0;}iframe{border:none;width:100%;}</style><iframe id="frame" sandbox="" src="[[_html]]"></iframe></template><script>var HTMLSandbox=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'dataURL',value:function(){var a=this;this._debouncer=Polymer.Debouncer.debounce(this._debouncer,Polymer.Async.timeOut.after(300),function(){a._html='data:text/html;charset=utf-8,'+escape(a.html)})}}],[{key:'is',get:function(){return'html-sandbox'}},{key:'properties',get:function(){return{html:String}}},{key:'observers',get:function(){return['dataURL(html)']}}]),b}(Polymer.Element);customElements.define(HTMLSandbox.is,HTMLSandbox);</script></dom-module></div><dom-module id="emailtemplates-page"><template><style include="light-page">:host{display:flex;flex-direction:column;height:calc(100vh - 65px);padding:0;--paper-input-container:{padding-bottom:16px;};}paper-item{cursor:pointer;}.columns{display:flex;}.columns > div{flex-grow:100000;padding:0 16px;overflow-y:auto;}.columns .rows{display:flex;flex-direction:column;overflow:hidden;}iron-list{flex-grow:100000;margin:0 0;overflow-x:hidden;}#newContainer{display:flex;}.fill{flex-basis:50%;}html-sandbox{flex-grow:100000;}table, td, th{border-collapse:collapse;border:none;}td, th{text-align:left;padding:5px 8px;}tr:nth-child(2n){background-color:#eee;}th{border-bottom:2px solid var(--primary-color);}.right{float:right;}</style><div class="columns"><div class="rows"><h1 title="">Email Templates</h1><iron-list items="[[templates]]"><template><paper-item on-tap="select"><paper-item-body two-line=""><div>[[item.slug]]</div><div secondary="">[[item.subj]]</div></paper-item-body></paper-item></template></iron-list><h3>New Template</h3><div id="newContainer"><paper-input id="slug" required="" auto-validate="" label="Slug" value="{{_slug}}"></paper-input><paper-button on-tap="new">New</paper-button></div></div><template is="dom-if" if="[[slug]]"><div class="fill"><div class="right"><nw-viewing viewing="" viewers="{{template.viewers}}" position="left" disabled="[[!template.slug]]" email="[[user.email]]" name="[[user.displayName]]"></nw-viewing><paper-button on-tap="publish" class="register" disabled="[[!different(template.body, template.draftBody, template.subj, template.draftSubj)]]">Publish</paper-button></div><h2>[[template.slug]]</h2><paper-input value="{{template.draftSubj}}" label="Subject"></paper-input><paper-textarea always-float-label="" value="{{template.draftBody}}" label="Body (Markdown)"></paper-textarea><h2>Variables</h2><table border="1" class="docutils"><thead valign="bottom"><tr class="row-odd"><th class="head">Variable</th><th class="head">Description</th></tr></thead><tbody valign="top"><tr class="row-even"><td>%recipient%</td><td>Full recipient spec, like “Bob &lt;<a class="reference external" href="mailto:bob%40example.com">bob<span>@</span>example<span>.</span>com</a>&gt;” (for using as value for “To” MIME header).</td></tr><tr class="row-odd"><td>%recipient_email%</td><td>Recipient’s email address, like <a class="reference external" href="mailto:bob%40example.com">bob<span>@</span>example<span>.</span>com</a>.</td></tr><tr class="row-even"><td>%recipient_name%</td><td>Recipient’s full name, like “John Q. Public”.</td></tr><tr class="row-odd"><td>%recipient_fname%</td><td>Recipient’s first name.</td></tr><tr class="row-even"><td>%recipient_lname%</td><td>Recipient’s last name.</td></tr><tr class="row-odd"><td>%unsubscribe_url%</td><td>A generated URL which allows users to unsubscribe from messages.</td></tr><tr class="row-even"><td>%mailing_list_unsubscribe_url%</td><td>A generated URL which allows users to unsubscribe from mailing lists.</td></tr><tr class="row-odd"><td>%unsubscribe_email%</td><td>An email address which can be used for automatic unsubscription by adding it to List-Unsubscribe MIME header.</td></tr><tr class="row-even"><td>%recipient.yourvar%</td><td>Accessing a custom datavalue.</td></tr></tbody></table></div><div class="fill rows"><h2>Preview</h2><paper-tabs selected="{{selected}}" attr-for-selected="text-content" scrollable=""><paper-tab>Draft</paper-tab><paper-tab>Published</paper-tab></paper-tabs><template is="dom-if" if="[[eq(selected, 'Draft')]]"><h3>[[render(template.draftSubj)]]</h3><html-sandbox html="[[renderBody(template.draftBody, emailTemplate)]]"></html-sandbox></template><template is="dom-if" if="[[eq(selected, 'Published')]]"><h3>[[render(template.subj)]]</h3><html-sandbox html="[[renderBody(template.body, emailTemplate)]]"></html-sandbox></template></div></template></div><firebase-query path="/admin/emailtemplates" disabled="[[!isAdmin]]" data="{{templates}}"></firebase-query><firebase-document path="/admin/emailtemplates/[[slug]]" disabled="[[!isAdmin]]" data="{{template}}"></firebase-document><iron-ajax auto="" url="/data/email.html" handle-as="text" last-response="{{emailTemplate}}"></iron-ajax><app-route route="{{route}}" active="{{routeActive}}" pattern="/:slug" data="{{routeData}}" tail="{{subRoute}}"></app-route></template><script>var EmailTemplatesPage=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'_pathChange',value:function(a){this.slug=a}},{key:'eq',value:function(c,a){return c===a}},{key:'publish',value:function(){confirm('Are you sure you want to publish? This isn\'t reversable.')&&(this.set('template.subj',this.template.draftSubj),this.set('template.body',this.template.draftBody))}},{key:'migrateTemplates',value:function(a){a.subj&&!a.draftSubj&&this.set('template.draftSubj',a.subj),a.body&&!a.draftBody&&this.set('template.draftBody',a.body)}},{key:'select',value:function(a){this.slug=a.model.item.$key,this.set('route.path',this.slug)}},{key:'renderBody',value:function(a,b){return b?this.render(b.replace('{{.}}',marked(a||''))):void 0}},{key:'different',value:function(a,b,c,d){return a!==b||c!==d}},{key:'new',value:function(){return this.$.slug.validate()?this.templates.hasOwnProperty(this._slug)?void(this._slug=''):void(this.set(['templates',this._slug],{slug:this._slug}),this._slug=''):void 0}},{key:'render',value:function(a){if(a)return a=a.replace(/%recipient%/g,'First Last <last@example.com>'),a=a.replace(/%recipient_email%/g,'last@example.com'),a=a.replace(/%recipient_name%/g,'First Last'),a=a.replace(/%recipient_fname%/g,'First'),a=a.replace(/%recipient_lname%/g,'Last'),a=a.replace(/%unsubscribe_url%/g,'https://example.com/unsubscribe_url'),a=a.replace(/%mailing_list_unsubscribe_url%/g,'https://example.com/mailing_list_unsubscribe_url'),a=a.replace(/%unsubscribe_email%/g,'unsubscribe@example.com'),a}}],[{key:'is',get:function(){return'emailtemplates-page'}},{key:'properties',get:function(){return{template:{type:Object},selected:{value:'Draft',type:String},slug:String}}},{key:'observers',get:function(){return['migrateTemplates(template)','_pathChange(routeData.slug)']}}]),b}(Polymer.Element);customElements.define(EmailTemplatesPage.is,EmailTemplatesPage);</script></dom-module></body></html>